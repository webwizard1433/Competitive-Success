<!DOCTYPE html>
<html lang="en" class="no-focus">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Test | Competitive Success</title>
    <link rel="icon" href="/success.png" type="image/png">
    <style>
        /* --- "Cosmic Gold" Theme --- */
        :root { --primary-color: #FFC107; --primary-hover-color: #DAA520; --card-background: rgba(255, 255, 255, 0.05); --card-border-color: rgba(255, 255, 255, 0.2); --text-color: #F5F5DC; --secondary-text-color: #adb5bd; --error-color: #e03131; --success-color: #2f9e44; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #0a192f;
            background-image: radial-gradient(at 80% 20%, hsla(212,40%,50%,0.3) 0px, transparent 50%), radial-gradient(at 20% 80%, hsla(280,40%,50%,0.3) 0px, transparent 50%);
            margin: 0; color: var(--text-color); min-height: 100vh; background-attachment: fixed;
            display: flex;
            flex-direction: column;
        }
        .main-container { padding: 2rem; max-width: 900px; margin: auto; width: 100%; box-sizing: border-box; animation: fadeIn 0.5s ease-out; }
        .page-header { text-align: center; margin-bottom: 2.5rem; }
        .page-header h1 { font-size: 3rem; color: var(--primary-color); margin: 0; }
        .page-header p { font-size: 1.2rem; color: var(--secondary-text-color); }
        .back-to-home { margin-bottom: 1.5rem; text-align: center; }
        .back-to-home a { display: inline-block; padding: 0.5rem 1rem; background-color: var(--card-background); border: 1px solid var(--card-border-color); color: var(--primary-color); text-decoration: none; font-weight: bold; border-radius: 5px; transition: background-color 0.3s ease; margin-bottom: 1rem; }
        .back-to-home a:hover { background-color: rgba(255, 255, 255, 0.1); }

        .typing-test-wrapper {
            background-color: var(--card-background);
            border: 1px solid var(--card-border-color);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.3);
            transition: box-shadow 0.3s ease;
        }
        .no-focus .typing-test-wrapper {
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.3), 0 0 0 3px rgba(255, 193, 7, 0.5);
        }

        .config-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--card-border-color);
            border-top: 1px solid var(--card-border-color);
        }
        .stat-box {
            text-align: center;
        }
        .stat-box .label {
            font-size: 1rem;
            color: var(--secondary-text-color);
            margin-bottom: 0.5rem;
        }
        .stat-box .value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .text-display-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .text-display {
            font-size: 1.5rem;
            line-height: 1.8;
            color: var(--secondary-text-color);
            height: 110px; /* Approx 2 lines */
            overflow: hidden;
            user-select: none;
        }

        .text-display span {
            transition: color 0.1s ease;
        }
        .text-display span.correct {
            color: var(--success-color);
        }
        .text-display span.incorrect {
            color: var(--error-color);
            text-decoration: underline;
        }
        .text-display span.current {
            background-color: var(--primary-color);
            color: #0a192f;
            border-radius: 3px;
        }
        .text-display span.current.error-flash {
            background-color: var(--error-color);
            color: white;
            animation: flash 0.2s ease;
        }

        .typing-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 2;
            cursor: text;
        }
        .no-focus .typing-input {
            z-index: -1; /* Hide input when not focused */
        }


        .controls {
            text-align: center;
        }
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color); 
            color: #000000;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: var(--primary-hover-color);
        }

        /* --- Results Modal --- */
        .results-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        .results-modal.show {
            display: flex;
        }
        .results-modal-content {
            background-color: var(--card-background);
            border: 1px solid var(--card-border-color);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.4);
        }
        .results-modal-content h2 {
            color: var(--primary-color);
            margin: 0 0 1.5rem;
        }
        .results-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2rem;
        }
        .results-stats .stat-box .value {
            font-size: 3rem;
        }
        .char-stats {
            font-size: 1.1rem;
            color: var(--secondary-text-color);
        }

        /* --- Animation --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes flash {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

    </style>
</head>
<body>
    <main class="main-container">
        <div class="back-to-home">
            <a href="/home.html">‚Üê Back to Main Menu</a>
        </div>

        <div class="config-container">
            <div class="stat-box">
                <div class="label">Duration</div>
                <select id="durationSelect" class="btn" style="padding: 0.5rem 1rem; font-size: 1rem;">
                    <option value="60">1 min</option>
                    <option value="180">3 min</option>
                    <option value="300">5 min</option>
                </select>
            </div>
        </div>

        <div class="page-header">
            <h1>Typing Test</h1>
            <p>Practice your typing speed and accuracy.</p>
        </div>

        <div class="typing-test-wrapper">
            <div class="stats-container">
                <div class="stat-box">
                    <div class="label">Time</div>
                    <div id="timer" class="value">60</div>
                </div>
                <div class="stat-box">
                    <div class="label">WPM</div>
                    <div id="wpm" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">Accuracy</div>
                    <div id="accuracy" class="value">100</div>
                </div>
            </div>

            <div class="text-display-wrapper">
                <div id="text-display" class="text-display" onclick="typingInput.focus()">
                    <!-- Text will be loaded here -->
                </div>
                <div id="focus-prompt" style="text-align: center; margin-top: 1rem; display: none;">Click here to start typing</div>
                <textarea id="typing-input" class="typing-input" spellcheck="false" autocorrect="off" autocapitalize="off"></textarea>
            </div>

            <div class="controls">
                <button id="restart-btn" class="btn">Restart Test</button>
            </div>
        </div>
    </main>

    <!-- Results Modal -->
    <div id="resultsModal" class="results-modal">
        <div class="results-modal-content">
            <h2>Test Complete!</h2>
            <div class="results-stats">
                <div class="stat-box">
                    <div class="label">Net WPM</div>
                    <div id="modal-wpm" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">Accuracy</div>
                    <div id="modal-accuracy" class="value">0%</div>
                </div>
            </div>
            <div class="char-stats">
                <p>Characters: <span id="modal-chars">0</span></p>
                <p>Mistakes: <span id="modal-mistakes">0</span></p>
            </div>
            <div class="controls" style="margin-top: 2rem;">
                <button id="tryAgainBtn" class="btn">Try Again</button>
            </div>
        </div>
    </div>

    <script>
        const paragraphs = [
            "The Union Public Service Commission, known as UPSC, is India's premier central recruiting agency. It is responsible for appointments to and examinations for All India services and group A & group B of Central services. The agency's charter is granted by Part XIV of the Constitution of India.",
            "Success in competitive exams often depends on a combination of knowledge, strategy, and time management. The ability to quickly process information and respond accurately under pressure is a key determinant of performance. Regular practice with mock tests is an invaluable tool for simulating real exam conditions.",
            "A positive mindset is a powerful asset. Believing in your ability to succeed is the first step towards achieving your goals. Cultivate a habit of self-discipline and perseverance. Challenges are not roadblocks but opportunities to grow stronger and more resilient. Every effort counts.",
            "The quick brown fox jumps over the lazy dog. This sentence contains every letter of the alphabet. Mastering typing is a crucial skill for many modern professions, enhancing both speed and accuracy in communication. Regular practice can significantly improve your words per minute (WPM).",
            "Technology has revolutionized the way we learn and work. Online platforms provide access to a wealth of information and educational resources that were once available only to a few. Embracing these tools can open up new opportunities for personal and professional growth. The future is digital."
        ];

        const textDisplay = document.getElementById('text-display');
        const typingInput = document.getElementById('typing-input');
        const timerEl = document.getElementById('timer');
        const wpmEl = document.getElementById('wpm');
        const accuracyEl = document.getElementById('accuracy');
        const restartBtn = document.getElementById('restart-btn');
        const durationSelect = document.getElementById('durationSelect');
        const focusPrompt = document.getElementById('focus-prompt');
        const resultsModal = document.getElementById('resultsModal');
        const tryAgainBtn = document.getElementById('tryAgainBtn');


        let TEST_DURATION = 60; // Default duration
        let timer;
        let inactivityTimer;
        let timeLeft = TEST_DURATION;
        let charIndex = 0;
        let mistakes = 0;
        let isTestStarted = false;
        let totalTyped = 0;

        // --- Event Listeners ---
        restartBtn.addEventListener('click', resetTest);
        tryAgainBtn.addEventListener('click', () => {
            resultsModal.classList.remove('show');
            resetTest();
        });
        durationSelect.addEventListener('change', (e) => {
            TEST_DURATION = parseInt(e.target.value);
            resetTest();
        });
        document.addEventListener('DOMContentLoaded', resetTest);
        typingInput.addEventListener('focus', () => {
            document.documentElement.classList.remove('no-focus');
            focusPrompt.style.display = 'none';
        });
        typingInput.addEventListener('blur', () => {
            document.documentElement.classList.add('no-focus');
            focusPrompt.style.display = 'block';
            if (isTestStarted) clearInterval(timer);
        });

        // --- Core Functions ---
        function getRandomParagraph() {
            const randomIndex = Math.floor(Math.random() * paragraphs.length);
            return paragraphs[randomIndex];
        }

        function initializeTest() {
            const paragraph = getRandomParagraph();
            textDisplay.innerHTML = '';
            paragraph.split('').forEach(char => {
                const span = document.createElement('span');
                span.innerText = char;
                textDisplay.appendChild(span);
            });
            if (textDisplay.firstChild) {
                textDisplay.firstChild.classList.add('current');
            }
            typingInput.value = '';
            typingInput.focus();
        }

        function resetTest() {
            clearInterval(timer);
            clearTimeout(inactivityTimer);
            timeLeft = TEST_DURATION;
            charIndex = 0;
            mistakes = 0;
            isTestStarted = false;

            timerEl.innerText = timeLeft;
            wpmEl.innerText = 0;
            accuracyEl.innerText = 100;
            typingInput.disabled = false;
            textDisplay.classList.remove('finished');
            resultsModal.classList.remove('show');

            initializeTest();
        }

        function startTimer() {
            // If timer is already running, do nothing.
            if (timer) clearInterval(timer);
            if (!isTestStarted) {
                isTestStarted = true;
            }
            
            timer = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                if (timeLeft === 0) {
                    clearInterval(timer);
                    typingInput.disabled = true;
                    calculateResults();
                    textDisplay.classList.add('finished');
                }
            }, 1000);
        }

        function calculateResults() {
            const typedChars = charIndex;
            const grossWPM = (typedChars / 5) / (TEST_DURATION / 60);
            const accuracy = typedChars > 0 ? Math.round(((typedChars - mistakes) / typedChars) * 100) : 100;
            const netWPM = Math.round(grossWPM * (accuracy / 100)) || 0;

            // Update main display (optional, as modal is primary)
            wpmEl.innerText = netWPM;
            accuracyEl.innerText = accuracy;

            // Populate and show modal
            document.getElementById('modal-wpm').innerText = netWPM;
            document.getElementById('modal-accuracy').innerText = `${accuracy}%`;
            document.getElementById('modal-chars').innerText = `${typedChars - mistakes}/${typedChars}`;
            document.getElementById('modal-mistakes').innerText = mistakes;
            resultsModal.classList.add('show');
        }

        typingInput.addEventListener('input', () => {
            const allChars = textDisplay.querySelectorAll('span');
            const typedValue = typingInput.value;

            // Start timer on first keypress
            if (!isTestStarted && timeLeft > 0) {
                startTimer();
            }

            // Resume timer if it was paused due to inactivity
            if (isTestStarted && !timer) {
                startTimer();
            }

            // Reset inactivity timer
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                if (isTestStarted && timeLeft > 0) clearInterval(timer);
            }, 5000);

            const typedChar = typedValue.slice(-1);
            const currentCharacterSpan = allChars[charIndex];

            // Handle backspace
            if (typedValue.length < charIndex) {
                charIndex--;
                const prevCharSpan = allChars[charIndex];
                const nextCharSpan = allChars[charIndex + 1];
                if (prevCharSpan.classList.contains('incorrect')) mistakes--;
                prevCharSpan.className = 'current';
                if(nextCharSpan) nextCharSpan.className = '';
                return;
            }

            // Handle correct/incorrect character
            if (typedChar === currentCharacterSpan.innerText) {
                currentCharacterSpan.className = 'correct';
            } else {
                currentCharacterSpan.className = 'incorrect';
                mistakes++;
            }

            charIndex++;

            // Move cursor to the next character
            if (charIndex < allChars.length) {
                allChars[charIndex].classList.add('current');
            } else {
                // Test finished by completing the text
                clearInterval(timer);
                calculateResults();
            }
            
            const timeElapsed = TEST_DURATION - timeLeft;
            if (timeElapsed > 0) {
                // Auto-scroll text display
                const currentSpan = allChars[charIndex];
                if (currentSpan && currentSpan.offsetTop > textDisplay.clientHeight - 30) {
                    textDisplay.scrollTop = currentSpan.offsetTop - textDisplay.clientHeight + 50;
                }

                // Calculate live WPM and Accuracy
                const grossWPM = (charIndex / 5) / (timeElapsed / 60);
                wpmEl.innerText = Math.round(grossWPM > 0 ? grossWPM : 0);
                const currentAccuracy = charIndex > 0 ? Math.round(((charIndex - mistakes) / charIndex) * 100) : 100;
                accuracyEl.innerText = currentAccuracy >= 0 ? currentAccuracy : 100;
            }
        });
    </script>
</body>
</html>